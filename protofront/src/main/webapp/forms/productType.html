<div>

	<div id="mm" class="easyui-menu" style="width: 120px;">
		<div data-options="iconCls:'icon-add'" onclick="newNode()">New
			Node</div>
		<div data-options="iconCls:'icon-remove'"
			onclick="removeNode()">Delete Node</div>
		<div data-options="iconCls:'icon-cut'"
			onclick="javascript:alert('cut')">Cut</div>
		<div data-options="iconCls:'icon-back'"
			onclick="javascript:alert('paste')">Paste</div>
	</div>

	<table id="productTypes" title="Product Types" class="easyui-treegrid"
		style="width: 700px; height: 300px"></table>
	<table id="edg" title="Translations" singleSelect="true" style="width: 700px; height: auto">
		<thead>
			<tr>
				<th
					data-options="field:'languageId',width:100,
                        	formatter:function(value,row){
                            return row.languageName;
                        },
                        editor:{
                            type:'combobox',
                            options:{
                                valueField:'id',
                                textField:'name',
                                method:'get',
                                url:'/protofront/service/masterdata/languagelist',
                                required:true
                            }
                        }">Language</th>
				<th field='productTypeName' width = 250 editor="text">Product Type Name</th>
			</tr>
		</thead>
	</table>


</div>

<script>
	$('#productTypes')
			.treegrid(
					{
						url : '/protofront/service/productType/getByParentTypeIdByLanguageId/'
								+ $('#langSelector').combobox('getValue'),
						idField : 'id',
						treeField : 'name',
						columns : [ [ {
							title : 'Product Types',
							field : 'name',
							width : 400
						} ] ],
						onSelect :function(data) {
							console.log(data['id']);
							$('#edg').edatagrid({
								url : '/protofront/service/productType/getNames/' + data['id'],
				             	saveUrl: 'save_user.php',
				             	updateUrl: 'update_user.php',
				             	destroyUrl: 'destroy_user.php'
				 
							});
						},
		                onContextMenu: function(e,row){
		                    e.preventDefault();
		                    $(this).treegrid('select',row.id);
		                    $('#mm').menu('show',{
		                        left: e.pageX,
		                        top: e.pageY
		                    });
		                }
					});

	 
	 function newNode() {
		 var node = $('#productTypes').treegrid('getSelected');
		 if (node){
			 $.ajax({
					type : 'POST',
					url : '/protofront/service/productType/getNewProductType',
					data:{
						parentId : node['id'], 
						languageId : $('#langSelector').combobox('getValue')
					},
					success : function(respdata) {
						var nodes = [{
							id : respdata['id'], 
							name : respdata['localizedProductName']
						}]
						$('#productTypes').treegrid('append', {
					         parent:node.id,
					         data :nodes,
					     });
					},
					error : function(data, status, er) {
						alert("error: " + data + " status: " + status + " er:" + er);
					}

				});
		     
		     
		 }
	 }
	 
	 function removeNode() {
		 var node = $('#productTypes').treegrid('getSelected');
		 if(node) {
			 $.ajax({
				 type: 'POST',
				 url: '/protofront/service/productType/delete',
				 data: {
					 id : node['id']
				 },
				 success : function() {
					 $('#productTypes').treegrid('remove', node.id);
					 $('#dg').datagrid('loadData', [{}]);
				 },
				 error : function(data, status, er) {
					alert("error: " + data + " status: " + status + " er:" + er);
				}
			 });
		 }
	 }
	 
	 $('#edg').edatagrid();
</script>
