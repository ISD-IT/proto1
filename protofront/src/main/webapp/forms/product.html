<!-- 
	Product form
	TODO:
	
-->

<div style="margin: 20px 0;"></div>
<div class="easyui-panel" title="Product" style="width: 800px">
	<div class="easyui-panel" style="padding: 5px;">
		<a href="javascript:void(0)" class="easyui-linkbutton"
			data-options="iconCls:'icon-add',plain:true" onclick="newProduct()">New</a>
		<a href="javascript:void(0)" class="easyui-linkbutton"
			data-options="iconCls:'icon-remove',plain:true"
			onclick="removeProduct()">Remove</a> <a href="javascript:void(0)"
			class="easyui-linkbutton"
			data-options="iconCls:'icon-save',plain:true"
			onclick="acceptProduct()">Accept</a> <a href="javascript:void(0)"
			class="easyui-linkbutton"
			data-options="iconCls:'icon-undo',plain:true"
			onclick="rejectProduct()">Reject</a> <a href="javascript:void(0)"
			class="easyui-linkbutton"
			data-options="iconCls:'icon-search',plain:true"
			onclick="searchProductType()">Search</a>
	</div>
	<div style="padding: 10px 30px 20px 30px">

			<h3>Select product type</h3>
			<input id="productType" class="easyui-combotree" value = "1"
				style="width: 600px;"
				data-options="url:'/protofront/service/productType/getByParentTypeIdByLanguageId/'
								+ $('#langSelector').combobox('getValue')">

			<table id="edgProducts" title="Products" singleSelect="true"
				style="width: 700px; height: auto">
				<thead>
					<tr>
						<th field='id' width=250>Product Id</th>
						<th field='name' width=250 editor="text">Product name</th>
					</tr>
				</thead>
			</table>

			<script>
				$("#edgProducts").edatagrid({});

				$("#productType").combotree({
					onSelect : function(record) {
						console.log(record);
						var lId = $('#langSelector').combobox('getValue');
						$("#edgProducts").edatagrid({
							url : '/protofront/service/product/prodListByProdTypeIdByLanguageId/'
											+ record.id + '&' + lId,
							onSelect : function(index, row) {
								console.log(row);
								$("#edgNames").edatagrid({
									url : '/protofront/service/product/names/'
												+ row.id
								});

								$("#edgParameters").edatagrid({
									url : '/protofront/service/product/parameters/'
												+ row.id + '&' + $('#langSelector').combobox('getValue')
								});
							} // OnSelect
						}); // edatagrid
					}// OnSelect
				}); // Combotree
			</script>
			
			<div id="aa" class="easyui-accordion"
				style="width: 700px; height: 400px;">
				<div title="Translations"
					data-options="iconCls:'icon-save',selected:false"
					style="overflow: auto; padding: 10px;" >
					<table id="edgNames" title="Translations" singleSelect="true"
						style="width: 600px; height: auto", 
						data-options="iconCls: 'icon-edit', toolbar: '#tbn'">
						<thead>
							<tr>
								<th field='nameId' width=250>Product Type Name Id</th>
								<th
									data-options="field:'languageId',width:100,
                        			formatter:function(value,row){
                            			return row.languageName;
                        			},
                       				editor:{
		                            	type:'combobox',
		                            	options:{
			                                valueField:'id',
			                                textField:'name',
			                                method:'get',
			                                url:'/protofront/service/masterdata/languagelist',
			                                required:true
			                            }
                        			}">Language</th>
								<th field='productName' width=250 editor="text">Product
									Name</th>
							</tr>
						</thead>
					</table>
					<script>
						$("#edgNames").edatagrid();
					</script>
				</div>
				<div title="Parameters template"
					data-options="iconCls:'icon-reload',selected:true"
					style="padding: 10px;">
					<table id="edgParameters" title="Parameters" singleSelect="true"
						style="width: 600px; height: auto",
						data-options="iconCls: 'icon-edit', toolbar: '#tbp', idField : 'productParameterId'">
						<thead>
							<tr>
								<th field='productParameterId' width=250>Product Parameter Id</th>
								<th
									data-options="field:'parameterId',width:100,
                        			formatter:function(value,row){
                            			return row.parameterName;
                        			},
                       				editor:{
		                            	type:'combobox',
		                            	options:{
			                                valueField:'parameterId',
			                                textField:'parameterName',
			                                method:'get',
			                                url:'/protofront/service/parameter/parameterNamesByLanguageId/' + $('#langSelector').combobox('getValue'),
			                                required:true
			                            }
                        			}">Parameter</th>
								<th
									data-options="field:'required',width:60,align:'center',editor:{type:'checkbox',options:{on:'true',off:'false'}}">Status</th>
							</tr>
						</thead>
					</table>
				</div>
				<div id="tbn" style="height: auto">
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-add',plain:true" onclick="appendName()">Append</a>
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-remove',plain:true"	onclick="removeName()">Remove</a> 
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-save',plain:true" onclick="saveName()">Accept</a>
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-undo',plain:true" onclick="rejectName()">Reject</a>
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-search',plain:true"
						onclick="getChanges()">GetChanges</a>
				</div>
				<div id="tbp" style="height: auto">
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-add',plain:true" onclick="appendParameter()">Append</a>
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-remove',plain:true"	onclick="removeParameter()">Remove</a> 
					<a href="javascript:void(0)"
						class="easyui-linkbutton"
						data-options="iconCls:'icon-save',plain:true" onclick="acceptParameter()">Accept</a>
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-undo',plain:true" onclick="rejectParameter()">Reject</a>
					<a href="javascript:void(0)" class="easyui-linkbutton"
						data-options="iconCls:'icon-search',plain:true"
						onclick="getChanges()">GetChanges</a>
				</div>

				<script>
					$("#edgParameters").edatagrid({
						saveUrl : '/protofront/service/product/saveParameter',
						destroyUrl : '/protofront/service/product/deleteParameter'
					});
				</script>

			</div>
	</div>
</div>

<script>

	function searchProductType() {
		var t = $('#productType').combotree('getTree');
		$('#productType').combotree('setValue', 3);
	}
	
	function newProduct() {
		var ptId = $('#productType').combotree('getValue');
		if (ptId) {
			$.ajax({
				type : 'POST',
				url : '/protofront/service/product/getNewProduct',
				data : {
					productTypeId : ptId,
					languageId : $('#langSelector')
							.combobox('getValue')
				},
				success : function(respdata) {
					$("#edgProducts").edatagrid('addRow', {
						row : {
							id : respdata['id'],
							name : respdata['localizedProductName']
						}
					});
				},
				error : function(data, status, er) {
					alert("error: " + data + " status: " + status
							+ " er:" + er);
				}
		
			}); 
		} // if
	}
	
	function removeParameter() {
		$("#edgParameters").edatagrid('destroyRow');
	}

	function appendParameter() {
		var pid = $("#edgProducts").edatagrid('getSelected').id;
		$("#edgParameters").edatagrid('addRow', {row: {productId : pid, required :false}});
	}
	
	function acceptParameter() {
		console.log($("#edgParameters").edatagrid('getSelected'));
		$("#edgParameters").edatagrid('saveRow');
	}
</script>